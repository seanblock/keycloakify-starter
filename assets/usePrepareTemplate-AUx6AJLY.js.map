{"version":3,"file":"usePrepareTemplate-AUx6AJLY.js","sources":["../../node_modules/keycloakify/tools/HTMLElement.prototype.prepend.js","../../node_modules/keycloakify/tools/headInsert.js","../../node_modules/keycloakify/lib/usePrepareTemplate.js"],"sourcesContent":["\"use strict\";\nif (!HTMLElement.prototype.prepend) {\n    HTMLElement.prototype.prepend = function (childNode) {\n        if (typeof childNode === \"string\") {\n            throw new Error(\"Error with HTMLElement.prototype.appendFirst polyfill\");\n        }\n        this.insertBefore(childNode, this.firstChild);\n    };\n}\n//# sourceMappingURL=HTMLElement.prototype.prepend.js.map","import \"./HTMLElement.prototype.prepend\";\nimport { Deferred } from \"evt/tools/Deferred\";\nexport function headInsert(params) {\n    const htmlElement = document.createElement((() => {\n        switch (params.type) {\n            case \"css\":\n                return \"link\";\n            case \"javascript\":\n                return \"script\";\n        }\n    })());\n    const dLoaded = new Deferred();\n    htmlElement.addEventListener(\"load\", () => dLoaded.resolve());\n    Object.assign(htmlElement, (() => {\n        switch (params.type) {\n            case \"css\":\n                return {\n                    \"href\": params.href,\n                    \"type\": \"text/css\",\n                    \"rel\": \"stylesheet\",\n                    \"media\": \"screen,print\"\n                };\n            case \"javascript\":\n                return {\n                    \"src\": params.src,\n                    \"type\": \"text/javascript\"\n                };\n        }\n    })());\n    document.getElementsByTagName(\"head\")[0][(() => {\n        switch (params.type) {\n            case \"javascript\":\n                return \"appendChild\";\n            case \"css\":\n                return (() => {\n                    switch (params.position) {\n                        case \"append\":\n                            return \"appendChild\";\n                        case \"prepend\":\n                            return \"prepend\";\n                    }\n                })();\n        }\n    })()](htmlElement);\n    return {\n        \"prLoaded\": dLoaded.pr,\n        \"remove\": () => htmlElement.remove()\n    };\n}\n//# sourceMappingURL=headInsert.js.map","import { useReducer, useEffect } from \"react\";\nimport { headInsert } from \"../tools/headInsert\";\nimport { clsx } from \"../tools/clsx\";\nimport { assert } from \"tsafe/assert\";\nexport function usePrepareTemplate(params) {\n    const { doFetchDefaultThemeResources, styles = [], scripts = [], htmlClassName, bodyClassName, htmlLangProperty, documentTitle } = params;\n    const [isReady, setReady] = useReducer(() => true, !doFetchDefaultThemeResources);\n    useEffect(() => {\n        if (htmlLangProperty === undefined) {\n            return;\n        }\n        const html = document.querySelector(\"html\");\n        assert(html !== null);\n        html.lang = htmlLangProperty;\n    }, [htmlLangProperty]);\n    useEffect(() => {\n        if (documentTitle === undefined) {\n            return;\n        }\n        document.title = documentTitle;\n    }, [documentTitle]);\n    useEffect(() => {\n        if (!doFetchDefaultThemeResources) {\n            return;\n        }\n        let isUnmounted = false;\n        const removeArray = [];\n        (async () => {\n            for (const style of [...styles].reverse()) {\n                const { prLoaded, remove } = headInsert({\n                    \"type\": \"css\",\n                    \"position\": \"prepend\",\n                    \"href\": style\n                });\n                removeArray.push(remove);\n                // TODO: Find a way to do that in parallel (without breaking the order)\n                await prLoaded;\n                if (isUnmounted) {\n                    return;\n                }\n            }\n            setReady();\n        })();\n        scripts.forEach(src => {\n            const { remove } = headInsert({\n                \"type\": \"javascript\",\n                src\n            });\n            removeArray.push(remove);\n        });\n        return () => {\n            isUnmounted = true;\n            removeArray.forEach(remove => remove());\n        };\n    }, []);\n    useSetClassName({\n        \"target\": \"html\",\n        \"className\": htmlClassName\n    });\n    useSetClassName({\n        \"target\": \"body\",\n        \"className\": bodyClassName\n    });\n    return { isReady };\n}\nfunction useSetClassName(params) {\n    const { target, className } = params;\n    useEffect(() => {\n        if (className === undefined) {\n            return;\n        }\n        const htmlClassList = document.getElementsByTagName(target)[0].classList;\n        const tokens = clsx(className).split(\" \");\n        htmlClassList.add(...tokens);\n        return () => {\n            htmlClassList.remove(...tokens);\n        };\n    }, [className]);\n}\n//# sourceMappingURL=usePrepareTemplate.js.map"],"names":["childNode","headInsert","params","htmlElement","dLoaded","Deferred","usePrepareTemplate","doFetchDefaultThemeResources","styles","scripts","htmlClassName","bodyClassName","htmlLangProperty","documentTitle","isReady","setReady","useReducer","useEffect","html","assert","isUnmounted","removeArray","style","prLoaded","remove","src","useSetClassName","target","className","htmlClassList","tokens","clsx"],"mappings":"wGACK,YAAY,UAAU,UACvB,YAAY,UAAU,QAAU,SAAUA,EAAW,CACjD,GAAI,OAAOA,GAAc,SACrB,MAAM,IAAI,MAAM,uDAAuD,EAE3E,KAAK,aAAaA,EAAW,KAAK,UAAU,CACpD,GCLO,SAASC,EAAWC,EAAQ,CAC/B,MAAMC,EAAc,SAAS,eAAe,IAAM,CAC9C,OAAQD,EAAO,KAAI,CACf,IAAK,MACD,MAAO,OACX,IAAK,aACD,MAAO,QACd,CACJ,GAAA,CAAG,EACEE,EAAU,IAAIC,EACpB,OAAAF,EAAY,iBAAiB,OAAQ,IAAMC,EAAQ,QAAS,CAAA,EAC5D,OAAO,OAAOD,GAAc,IAAM,CAC9B,OAAQD,EAAO,KAAI,CACf,IAAK,MACD,MAAO,CACH,KAAQA,EAAO,KACf,KAAQ,WACR,IAAO,aACP,MAAS,cAC7B,EACY,IAAK,aACD,MAAO,CACH,IAAOA,EAAO,IACd,KAAQ,iBAC5B,CACS,CACJ,GAAA,CAAG,EACJ,SAAS,qBAAqB,MAAM,EAAE,CAAC,GAAG,IAAM,CAC5C,OAAQA,EAAO,KAAI,CACf,IAAK,aACD,MAAO,cACX,IAAK,MACD,OAAQ,IAAM,CACV,OAAQA,EAAO,SAAQ,CACnB,IAAK,SACD,MAAO,cACX,IAAK,UACD,MAAO,SACd,CACrB,IACS,CACT,GAAQ,CAAA,EAAEC,CAAW,EACV,CACH,SAAYC,EAAQ,GACpB,OAAU,IAAMD,EAAY,OAAQ,CAC5C,CACA,CC5CO,SAASG,EAAmBJ,EAAQ,CACvC,KAAM,CAAE,6BAAAK,EAA8B,OAAAC,EAAS,CAAA,EAAI,QAAAC,EAAU,CAAA,EAAI,cAAAC,EAAe,cAAAC,EAAe,iBAAAC,EAAkB,cAAAC,CAAa,EAAKX,EAC7H,CAACY,EAASC,CAAQ,EAAIC,EAAU,WAAC,IAAM,GAAM,CAACT,CAA4B,EAChFU,OAAAA,EAAAA,UAAU,IAAM,CACZ,GAAIL,IAAqB,OACrB,OAEJ,MAAMM,EAAO,SAAS,cAAc,MAAM,EAC1CC,SAAOD,IAAS,IAAI,EACpBA,EAAK,KAAON,CACpB,EAAO,CAACA,CAAgB,CAAC,EACrBK,EAAAA,UAAU,IAAM,CACRJ,IAAkB,SAGtB,SAAS,MAAQA,EACzB,EAAO,CAACA,CAAa,CAAC,EAClBI,EAAAA,UAAU,IAAM,CACZ,GAAI,CAACV,EACD,OAEJ,IAAIa,EAAc,GAClB,MAAMC,EAAc,CAAA,EACpB,OAAC,SAAY,CACT,UAAWC,IAAS,CAAC,GAAGd,CAAM,EAAE,QAAO,EAAI,CACvC,KAAM,CAAE,SAAAe,EAAU,OAAAC,CAAQ,EAAGvB,EAAW,CACpC,KAAQ,MACR,SAAY,UACZ,KAAQqB,CAC5B,CAAiB,EAID,GAHAD,EAAY,KAAKG,CAAM,EAEvB,MAAMD,EACFH,EACA,MAEP,CACDL,GACZ,KACQN,EAAQ,QAAQgB,GAAO,CACnB,KAAM,CAAE,OAAAD,CAAQ,EAAGvB,EAAW,CAC1B,KAAQ,aACR,IAAAwB,CAChB,CAAa,EACDJ,EAAY,KAAKG,CAAM,CACnC,CAAS,EACM,IAAM,CACTJ,EAAc,GACdC,EAAY,QAAQG,GAAUA,EAAQ,CAAA,CAClD,CACK,EAAE,CAAE,CAAA,EACLE,EAAgB,CACZ,OAAU,OACV,UAAahB,CACrB,CAAK,EACDgB,EAAgB,CACZ,OAAU,OACV,UAAaf,CACrB,CAAK,EACM,CAAE,QAAAG,CAAO,CACpB,CACA,SAASY,EAAgBxB,EAAQ,CAC7B,KAAM,CAAE,OAAAyB,EAAQ,UAAAC,CAAW,EAAG1B,EAC9Be,EAAAA,UAAU,IAAM,CACZ,GAAIW,IAAc,OACd,OAEJ,MAAMC,EAAgB,SAAS,qBAAqBF,CAAM,EAAE,CAAC,EAAE,UACzDG,EAASC,EAAKH,CAAS,EAAE,MAAM,GAAG,EACxC,OAAAC,EAAc,IAAI,GAAGC,CAAM,EACpB,IAAM,CACTD,EAAc,OAAO,GAAGC,CAAM,CAC1C,CACA,EAAO,CAACF,CAAS,CAAC,CAClB","x_google_ignoreList":[0,1,2]}