import{r as b,u as K,j as t,a as C,k as V,t as q}from"./index-CbRHuHWR.js";import{c as N}from"./useGetClassName--CzfVzr1.js";import{u as z}from"./useGetClassName-DN9hEdVF.js";function M(l,e,a){var f;if(a===void 0&&(a={}),!e.codes){e.codes={};for(var d=0;d<e.chars.length;++d)e.codes[e.chars[d]]=d}if(!a.loose&&l.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var o=l.length;l[o-1]==="=";)if(--o,!a.loose&&!((l.length-o)*e.bits&7))throw new SyntaxError("Invalid padding");for(var s=new((f=a.out)!=null?f:Uint8Array)(o*e.bits/8|0),i=0,r=0,h=0,n=0;n<o;++n){var v=e.codes[l[n]];if(v===void 0)throw new SyntaxError("Invalid character "+l[n]);r=r<<e.bits|v,i+=e.bits,i>=8&&(i-=8,s[h++]=255&r>>i)}if(i>=e.bits||255&r<<8-i)throw new SyntaxError("Unexpected end of data");return s}function Q(l,e,a){a===void 0&&(a={});for(var f=a,d=f.pad,o=d===void 0?!0:d,s=(1<<e.bits)-1,i="",r=0,h=0,n=0;n<l.length;++n)for(h=h<<8|255&l[n],r+=8;r>e.bits;)r-=e.bits,i+=e.chars[s&h>>r];if(r&&(i+=e.chars[s&h<<e.bits-r]),o)for(;i.length*e.bits&7;)i+="=";return i}var A={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},x={parse:function(e,a){return M(e,A,a)},stringify:function(e,a){return Q(e,A,a)}};function tt(l){const{kcContext:e,i18n:a,doUseDefaultCss:f,Template:d,classes:o}=l,{getClassName:s}=z({doUseDefaultCss:f,classes:o}),{url:i}=e,{msg:r,msgStr:h}=a,{authenticators:n,challenge:v,shouldDisplayAuthenticators:S,userVerification:y,rpId:I}=e,w=Number(e.createTimeout),O=e.isUserIdentified=="true",g=b.useRef(null),D=K(async()=>{if(!O)return;const c=async()=>{const u=g.current;if(u===null)return await new Promise(m=>setTimeout(m,100)),c();u.submit()},p=n.authenticators.map(u=>({id:x.parse(u.credentialId,{loose:!0}),type:"public-key"}));if(!window.PublicKeyCredential){k(h("webauthn-unsupported-browser-text")),c();return}const j={rpId:I,challenge:x.parse(v,{loose:!0})};w!==0&&(j.timeout=w*1e3),p.length&&(j.allowCredentials=p),y!=="not specified"&&(j.userVerification=y);try{const u=await navigator.credentials.get({publicKey:j});if(!u||u.type!="public-key"||(C.assert(V(u)),!("authenticatorData"in u.response)))return;const m=u.response,G=m.clientDataJSON;C.assert(q(m,"signature"in m&&m.authenticatorData instanceof ArrayBuffer),"response not an AuthenticatorAssertionResponse");const W=m.authenticatorData,$=m.signature;U(x.stringify(new Uint8Array(G),{pad:!1})),L(x.stringify(new Uint8Array(W),{pad:!1})),P(x.stringify(new Uint8Array($),{pad:!1})),J(u.id),_(x.stringify(new Uint8Array(m.userHandle),{pad:!1}))}catch(u){k(String(u))}c()}),[E,U]=b.useState(""),[F,L]=b.useState(""),[B,P]=b.useState(""),[H,J]=b.useState(""),[T,_]=b.useState(""),[R,k]=b.useState("");return t.jsx(d,Object.assign({},{kcContext:e,i18n:a,doUseDefaultCss:f,classes:o},{headerNode:r("webauthn-login-title")},{children:t.jsxs("div",Object.assign({id:"kc-form-webauthn",className:s("kcFormClass")},{children:[t.jsxs("form",Object.assign({id:"webauth",action:i.loginAction,ref:g,method:"post"},{children:[t.jsx("input",{type:"hidden",id:"clientDataJSON",name:"clientDataJSON",value:E}),t.jsx("input",{type:"hidden",id:"authenticatorData",name:"authenticatorData",value:F}),t.jsx("input",{type:"hidden",id:"signature",name:"signature",value:B}),t.jsx("input",{type:"hidden",id:"credentialId",name:"credentialId",value:H}),t.jsx("input",{type:"hidden",id:"userHandle",name:"userHandle",value:T}),t.jsx("input",{type:"hidden",id:"error",name:"error",value:R})]})),t.jsxs("div",Object.assign({className:s("kcFormGroupClass")},{children:[n&&t.jsx("form",Object.assign({id:"authn_select",className:s("kcFormClass")},{children:n.authenticators.map(c=>t.jsx("input",{type:"hidden",name:"authn_use_chk",value:c.credentialId},c.credentialId))})),n&&S&&t.jsxs(t.Fragment,{children:[n.authenticators.length>1&&t.jsx("p",Object.assign({className:s("kcSelectAuthListItemTitle")},{children:r("webauthn-available-authenticators")})),t.jsx("div",Object.assign({className:s("kcFormClass")},{children:n.authenticators.map(c=>t.jsxs("div",Object.assign({id:"kc-webauthn-authenticator",className:s("kcSelectAuthListItemClass")},{children:[t.jsx("div",Object.assign({className:s("kcSelectAuthListItemIconClass")},{children:t.jsx("i",{className:N((()=>{const p=s(c.transports.iconClass);return p.includes(" ")?p:[p,s("kcWebAuthnDefaultIcon")]})(),s("kcSelectAuthListItemIconPropertyClass"))})})),t.jsxs("div",Object.assign({className:s("kcSelectAuthListItemBodyClass")},{children:[t.jsx("div",Object.assign({id:"kc-webauthn-authenticator-label",className:s("kcSelectAuthListItemHeadingClass")},{children:c.label})),c.transports&&c.transports.displayNameProperties.length&&t.jsx("div",Object.assign({id:"kc-webauthn-authenticator-transport",className:s("kcSelectAuthListItemDescriptionClass")},{children:c.transports.displayNameProperties.map((p,j)=>t.jsxs(t.Fragment,{children:[t.jsx("span",{children:r(p)}),j<c.transports.displayNameProperties.length-1&&t.jsx("span",{children:", "})]}))})),t.jsxs("div",Object.assign({className:s("kcSelectAuthListItemDescriptionClass")},{children:[t.jsx("span",Object.assign({id:"kc-webauthn-authenticator-created-label"},{children:r("webauthn-createdAt-label")})),t.jsx("span",Object.assign({id:"kc-webauthn-authenticator-created"},{children:c.createdAt}))]}))]})),t.jsx("div",{className:s("kcSelectAuthListItemFillClass")})]})))}))]}),t.jsx("div",Object.assign({id:"kc-form-buttons",className:s("kcFormButtonsClass")},{children:t.jsx("input",{id:"authenticateWebAuthnButton",type:"button",onClick:D,autoFocus:!0,value:h("webauthn-doAuthenticate"),className:N(s("kcButtonClass"),s("kcButtonPrimaryClass"),s("kcButtonBlockClass"),s("kcButtonLargeClass"))})}))]}))]}))}))}export{tt as default};
